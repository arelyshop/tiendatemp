<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arelyshop.com - Producto</title>

    <!-- SEO and Social Sharing Meta Tags -->
    <meta name="description" content="Visita Arelyshop.com y descubre los mejores accesorios y gadgets de UGREEN | BASEUS | ANKER para hacer tu día más fácil.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://arelyshop.com/product.html">
    <meta property="og:title" content="Arelyshop.com - Producto">
    <meta property="og:description" content="Visita Arelyshop.com y descubre los mejores accesorios y gadgets de UGREEN | BASEUS | ANKER para hacer tu día más fácil.">
    <meta property="og:image" content="https://arelyshop.com/images/arelyshop-preview.webp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://arelyshop.com/product.html">
    <meta name="twitter:title" content="Arelyshop.com - Producto">
    <meta name="twitter:description" content="Visita Arelyshop.com y descubre los mejores accesorios y gadgets de UGREEN | BASEUS | ANKER para hacer tu día más fácil.">
    <meta name="twitter:image" content="https://arelyshop.com/images/arelyshop-preview.webp">

    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .thumbnail-active { border-color: #000; }
        @keyframes cart-bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .cart-bounce-animation { animation: cart-bounce 0.5s ease; }
        .product-title { height: 2.5em; line-height: 1.25em; overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; text-overflow: ellipsis; }
        .custom-scrollbar::-webkit-scrollbar, .search-results-container::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track, .search-results-container::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb, .search-results-container::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover, .search-results-container::-webkit-scrollbar-thumb:hover { background: #555; }
        .sold-out-watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); background-color: rgba(0, 0, 0, 0.7); color: white; font-weight: bold; padding: 6px 12px; font-size: 1rem; border-radius: 8px; z-index: 10; pointer-events: none; display: flex; align-items: center; gap: 0.375rem; white-space: nowrap; }
        .sold-out-watermark svg { width: 1em; height: 1em; }
        #sidenav, #cart-flyout { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        #sidenav-overlay, #cart-overlay { transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main class="flex-grow">
        <div id="product-details-container" class="container mx-auto px-4 md:px-0 mt-4 md:mt-8">
            <div id="loading-product" class="text-center py-20"><p class="text-gray-500">Cargando producto...</p></div>
        </div>
        <section id="similar-products-section" class="container mx-auto px-4 md:px-0 mt-16 hidden">
             <div class="md:w-[85%] md:mx-auto">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">Productos Similares</h2>
                <div id="similar-products-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="/js/main.js"></script>
    <script>
        window.addEventListener('shared-components-loaded', ({ detail }) => {
            const { allProducts, addToCart, createProductCard } = detail;
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('id'));
            const container = document.getElementById('product-details-container');

            const currentProduct = allProducts.find(p => p.id === productId);

            if (!currentProduct) {
                container.innerHTML = `<p class="text-center py-20 text-red-500 font-semibold">Producto no encontrado.</p>`;
                return;
            }

            // --- RENDER PRODUCT DETAILS ---
            document.title = `Arelyshop.com - ${currentProduct.name}`;
            const photoUrls = [1, 2, 3, 4, 5, 6, 7, 8].map(i => currentProduct[`photo_url_${i}`]).filter(Boolean);
            if (photoUrls.length === 0) photoUrls.push('https://placehold.co/600x600/e2e8f0/cbd5e0?text=Sin+Imagen');
            
            const isOutOfStock = currentProduct.stock <= 0;
            let priceHTML = '', discountBadgeHTML = '', stockHTML = '';
            
            if (!isOutOfStock && currentProduct.discount_price && currentProduct.sale_price && currentProduct.discount_price < currentProduct.sale_price) {
                const discountPercentage = Math.round(((currentProduct.sale_price - currentProduct.discount_price) / currentProduct.sale_price) * 100);
                priceHTML = `<div class="flex items-end space-x-2"><span class="text-2xl font-bold text-red-600">Bs. ${Math.round(currentProduct.discount_price)}</span><span class="text-lg text-gray-500 line-through">Bs. ${Math.round(currentProduct.sale_price)}</span></div>`;
                discountBadgeHTML = `
                    <div class="w-8 h-auto ml-2">
                        <svg data-name="Capa 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 302.44 402.78">
                            <defs>
                                <linearGradient id="discount-grad-detail-${currentProduct.id}" x1="151.22" y1="402.78" x2="151.22" y2="0" gradientUnits="userSpaceOnUse">
                                    <stop offset="0" stop-color="#e20919"/><stop offset="1" stop-color="#fb6404"/>
                                </linearGradient>
                            </defs>
                            <g>
                                <path fill="url(#discount-grad-detail-${currentProduct.id})" fill-rule="evenodd" d="M61.01,179.91C51.45,94.39,101.43,34.24,195.1,0c-57.38,74.43,48.9,155.06,54.76,232.36,13.74-23.43,21.53-54.72,23.08-96.52,70.24,110.2,12.01,290.3-142.57,264.42-14.19-2.37-27.87-6.85-40.33-13.52C33.68,356.62,0,291.04,0,228.4c0-39.92,17.08-75.57,39.18-103.89,2.95,27.75,9.24,48.44,21.83,55.4Z"/>
                            </g>
                            <text x="151.22" y="280" font-family="Inter, sans-serif" font-weight="bold" fill="white" text-anchor="middle">
                                <tspan font-size="80">${discountPercentage}%</tspan>
                                <tspan x="151.22" dy="80" font-size="90">OFF</tspan>
                            </text>
                        </svg>
                    </div>`;
            } else {
                priceHTML = `<p class="text-2xl font-bold text-gray-900">Bs. ${Math.round(currentProduct.sale_price)}</p>`;
            }
            stockHTML = isOutOfStock ? `<p class="mt-2 font-semibold text-lg text-gray-700">Agotado</p>` : (currentProduct.stock <= 5 ? `<p class="mt-2 font-semibold text-lg text-red-600">¡Solo quedan ${currentProduct.stock}!</p>` : `<p class="mt-2 font-semibold text-lg text-green-600">En stock</p>`);

            const description = currentProduct.description || 'No hay descripción disponible.';
            const snippetLength = 800;
            const hasLongDescription = description.length > snippetLength;
            let descriptionHTML = `<p class="text-gray-600 mt-4 whitespace-pre-wrap">${description.replace(/\*(.*?)\*/g, '<strong>$1</strong>')}</p>`;
            if(hasLongDescription) { /* ... logic for 'Ver más' ... */ }

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:w-[85%] md:mx-auto">
                    <!-- Image Gallery -->
                    <div>
                        <div class="relative">
                            <div id="main-image-container" class="aspect-square bg-white rounded-lg shadow-md mb-4 overflow-hidden">
                                <img id="main-product-image" src="${photoUrls[0]}" alt="${currentProduct.name}" class="w-full h-full object-contain rounded-lg bg-white">
                            </div>
                            <button id="prev-image-btn" class="absolute top-1/2 left-4 -translate-y-1/2 bg-white/50 hover:bg-white p-2 rounded-full shadow-md transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                            <button id="next-image-btn" class="absolute top-1/2 right-4 -translate-y-1/2 bg-white/50 hover:bg-white p-2 rounded-full shadow-md transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                        </div>
                        <div id="thumbnail-container" class="custom-scrollbar flex space-x-2 overflow-x-auto pb-2">
                            ${photoUrls.map((url, i) => `<img src="${url}" alt="Thumbnail ${i + 1}" class="bg-white w-20 h-20 flex-shrink-0 object-contain rounded-md cursor-pointer border-2 ${i === 0 ? 'thumbnail-active' : 'border-transparent'} hover:border-gray-400 transition" data-index="${i}">`).join('')}
                        </div>
                    </div>
                    <!-- Product Info -->
                    <div class="flex flex-col">
                        <h1 class="text-2xl font-bold text-gray-900">${currentProduct.name}</h1>
                        <p class="text-sm text-gray-500 mt-1">SKU: ${currentProduct.sku || 'No disponible'}</p>
                        <div class="mt-2 flex items-end">${priceHTML} ${discountBadgeHTML}</div>
                        ${stockHTML}
                        <div class="mt-4">
                             <button id="page-add-to-cart-btn" class="w-full bg-black text-white text-lg py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2 ${isOutOfStock ? 'opacity-50 cursor-not-allowed' : ''}" ${isOutOfStock ? 'disabled' : ''}>
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M440-600v-120H320v-80h120v-120h80v120h120v80H520v120h-80ZM280-80q-33 0-56.5-23.5T200-160q0-33 23.5-56.5T280-240q33 0 56.5 23.5T360-160q0 33-23.5 56.5T280-80Zm400 0q-33 0-56.5-23.5T600-160q0-33 23.5-56.5T680-240q33 0 56.5 23.5T760-160q0 33-23.5 56.5T680-80ZM40-800v-80h131l170 360h280l156-280h91L692-482q-11 20-29.5 31T622-440H324l-44 80h480v80H280q-45 0-68.5-39t-1.5-79l54-98-144-304H40Z"/></svg>
                                <span>${isOutOfStock ? 'Agotado' : 'Agregar al Carrito'}</span>
                            </button>
                        </div>
                        <div class="mt-6 flex-grow">
                            <h2 class="text-lg font-semibold text-gray-800 border-b pb-2">Descripción:</h2>
                            ${descriptionHTML}
                        </div>
                    </div>
                </div>`;
            
            // --- EVENT LISTENERS FOR PRODUCT PAGE ---
            document.getElementById('page-add-to-cart-btn').addEventListener('click', () => {
                addToCart(currentProduct.name, currentProduct.discount_price || currentProduct.sale_price);
            });
            
            // Gallery listeners
            let currentIndex = 0;
            const mainImg = document.getElementById('main-product-image');
            const thumbs = document.querySelectorAll('#thumbnail-container img');
            
            const showImage = (index) => {
                if (index >= photoUrls.length) index = 0;
                if (index < 0) index = photoUrls.length - 1;
                mainImg.src = photoUrls[index];
                currentIndex = index;
                
                thumbs.forEach((thumb, i) => {
                    const isActive = i === currentIndex;
                    thumb.classList.toggle('thumbnail-active', isActive);
                    // If this is the active thumbnail, scroll it into view
                    if (isActive) {
                        thumb.scrollIntoView({
                            behavior: 'smooth',
                            block: 'nearest',
                            inline: 'center'
                        });
                    }
                });
            };

            document.getElementById('prev-image-btn').addEventListener('click', () => showImage(currentIndex - 1));
            document.getElementById('next-image-btn').addEventListener('click', () => showImage(currentIndex + 1));
            thumbs.forEach(thumb => thumb.addEventListener('click', (e) => showImage(parseInt(e.target.dataset.index))));

            // --- RENDER SIMILAR PRODUCTS ---
            const similarProducts = allProducts.filter(p => p.id !== currentProduct.id && (p.category === currentProduct.category || p.brand === currentProduct.brand)).slice(0, 5);
            if (similarProducts.length > 0) {
                document.getElementById('similar-products-section').classList.remove('hidden');
                const grid = document.getElementById('similar-products-grid');
                grid.innerHTML = similarProducts.map(p => createProductCard(p)).join('');
            }
        });
    </script>
</body>
</html>
